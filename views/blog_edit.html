<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/static/css/wangeditoreditor@5.1style.css" rel="stylesheet">
    <link href="/static/layui/css/layui.css" rel="stylesheet">
    <link href="/static/css/cnds.css" rel="stylesheet">
    <link href="/static/css/bomm.css" rel="stylesheet">

    <style>
        .content {
            height: calc(100% - 40px);
            background-color: rgb(245, 245, 245);
            overflow-y: auto;
            position: relative;
        }

        .editor-container {
            width: 850px;
            margin: 30px auto 15px auto;
            background-color: #fff;
            padding: 20px 50px 50px 50px;
            border: 1px solid #e8e8e8;
            box-shadow: 0 2px 10px rgb(0 0 0 / 12%);
        }
        .editor-container1 {
            width: 850px;
            margin: 5px auto 150px auto;
            background-color: #fff;
            padding: 20px 50px 50px 50px;
            border: 1px solid #e8e8e8;
            box-shadow: 0 2px 10px rgb(0 0 0 / 12%);
        }
        #title-container {
            padding: 20px 0;
            border-bottom: 1px solid #e8e8e8;
        }

        #title-container input {
            font-size: 30px;
            border: 0;
            outline: none;
            width: 100%;
            line-height: 1;
        }

        #editor-text-area {
            min-height: 600px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div id="csdn-toolbar" style="position: relative; min-width: 100%; width: max-content; top: 0px; left: 0px;">
    <div class="toolbar-inside">
        <div class="toolbar-container">
            <div class="toolbar-container-left">
                <div class="toolbar-logo"><a href=""><img title="CSDN首页" src="/static/img/logo.png"></a>
                </div>
                <ul class="toolbar-menus csdn-toolbar-fl">
                    <li class="active " title="阅读深度、前沿文章">
                        <a href="https://blog.csdn.net/"> 博客</a>
                    </li>
                    <li class="active " title="阅读深度、前沿文章">
                        <a href="https://blog.csdn.net/"> 下载</a>
                    </li>
                    <li class="active " title="阅读深度、前沿文章">
                        <a href="https://blog.csdn.net/"> 学习</a>
                    </li>
                </ul>
            </div>
            <div class="toolbar-container-right">
                <div class="toolbar-btns">
                    <div class="toolbar-btn_tx">
                        <a class="hasAvatar" href="https://blog.csdn.net/qq_33989915"><img
                                src="/static/img/tx.jpg"></a>
                    </div>
                    <div class="toolbar-btn ">
                        <a href="https://i.csdn.net/#/user-center/collection-list?type=1">足迹</a>
                    </div>
                    <div class="toolbar-btn">
                        <a href="https://blink.csdn.net">动态</a>
                        <div class="toolbar-dynamic-subMenu">
                            <a class="vote-item" href="https://blink.csdn.net/?source=vote">
                                <span class="pos-rel">投票<i style="display: inline;"></i></span>
                            </a>
                        </div>
                    </div>
                    <div class="toolbar-btn ">
                        <div class="toolbar-subMenu-box">
                            <a id="toolbar-remind" href="https://i.csdn.net/#/msg/index">消息</a>
                        </div>
                        <div class="toolbar-msg-box"></div>
                    </div>
                    <div class="toolbar-btn-write">
                        <a data-report-click="{&quot;spm&quot;:&quot;3001.4503&quot;}" data-report-query="spm=3001.4503"
                           href="/edit"><i></i>发布</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div style="border-bottom: 1px solid #e8e8e8;">
    <div id="editor-toolbar"></div>
</div>
<div id="content" class="content">
    <div id="editor-container" class="editor-container">
        <div id="title-container">
            <input placeholder="请输入标题！" id="blog_title">
        </div>
        <div id="editor-text-area"></div>
        <div id="top-container">
        </div>
    </div>
</div>
<div data-v-173330b0="" class="el-form-item"><!---->
    <div class="el-form-item__content" style="margin-left: 90px;">
        <div class="opt-box">
            <div class="btn-box">
                <span>
                     <span class="el-popover__reference-wrapper">
                         <button type="button" class="el-button" tabindex="0">
                             <span>保存草稿
                                 <i class="el-icon-caret-bottom" style="margin-left: 4px; margin-right: -2px;"></i>
                            </span>
                        </button>
                     </span>
                </span>
                <button type="button" class="el-button btn-outline-danger">
                    <span style="color: white"> 发布博客</span>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="content">
    <div class="editor-container1">
    </div>
</div >
</body>
<script src="/static/js/wangeditoreditor@5.1.15distindex.js"></script>
<script src="/static/js/jquery2.1.1.min.js"></script>
<script src="/static/layui/layui.js"></script>
<script>

    const E = window.wangEditor
    // Change language
    const LANG = location.href.indexOf('lang=en') > 0 ? 'en' : 'zh-CN'
    E.i18nChangeLanguage(LANG)

    const editorConfig = {MENU_CONF: {}}
    editorConfig.MENU_CONF['uploadImage'] = {
        server: '/api/upload_img',
        // server: '/api/upload-img-10s', // test timeout
        // server: '/api/upload-img-failed', // test failed
        // server: '/api/xxx', // test 404

        timeout: 5 * 1000, // 5s

        fieldName: 'custom-fileName',
        meta: {token: 'xxx', a: 100},
        metaWithUrl: true, // join params to url
        headers: {Accept: 'text/x-json'},

        maxFileSize: 10 * 1024 * 1024, // 10M

        base64LimitSize: 5 * 1024, // insert base64 format, if file's size less than 5kb

        onBeforeUpload(file) {
            console.log('onBeforeUpload', file)

            return file // will upload this file
            // return false // prevent upload
        },
        onProgress(progress) {
            console.log('onProgress', progress)
        },
        onSuccess(file, res) {
            console.log('onSuccess', file, res)
        },
        onFailed(file, res) {
            alert(res.message)
            console.log('onFailed', file, res)
        },
        onError(file, err, res) {
            alert(err.message)
            console.error('onError', file, err, res)
        },

        // customInsert(res, insertFn) {
        //   console.log('customInsert', res)
        //   const imgInfo = res.data[0] || {}
        //   const { url, alt, href } = imgInfo
        //   if (!url) throw new Error(`Image url is empty`)

        //   console.log('Your image url ', url)
        //   insertFn(url, alt, href)
        // },

        // customUpload(file, insertFn) {
        //   console.log('customUpload', file)

        //   return new Promise((resolve) => {
        //     // Simulate async insert image
        //     setTimeout(() => {
        //       const src = `https://www.baidu.com/img/flexible/logo/pc/result@2.png?r=${Math.random()}`
        //       insertFn(src, 'baidu logo', src)
        //       resolve('ok')
        //     }, 500)
        //   })
        // },

        // customBrowseAndUpload(insertFn) {
        //   alert('Custom browse and upload')

        //   // Simulate async insert image
        //   setTimeout(() => {
        //     const src = 'https://www.baidu.com/img/flexible/logo/pc/result@2.png'
        //     insertFn(src, 'baidu logo', src) // insert a image
        //   }, 500)
        // },
    }

    const editor = E.createEditor({
        selector: '#editor-text-area',
        html: '<p>请输入内容！</p><p><br></p>',
        config: editorConfig
    })

    const toolbar = E.createToolbar({
        editor,
        selector: '#editor-toolbar',
        config: {
            excludeKeys: 'fullScreen',
        }
        // config: {}
    })
    layui.use(['layer'], function () {
        $('#hq').on('click', function () {
            var date = {
                BlogTitle: $('#blog_title').val(),
                BlogContent: editor.getHtml(),
                //  BlogId: 1,
                BlogBrief: "",
                //   BlogCreateTime: "",
                //  BlogCreateUser: "",
                BlogImgUrl: "",
                BlogType: 1,
                //   BlogLastModifyTime: "",
                BlogState: 0
            }
            // alert(JSON.stringify(date))
            $.ajax({
                type: "POST",
                url: 'api/edit_submit',
                data: JSON.stringify(date),
                contentType: "application/json",
                dataType: "json",
                beforeSend: function () {
                    // TODO...
                },
                success: function (res) {
                    if (res.code == 0) {

                        // 提示语
                        layer.msg('提交成功', {
                            icon: 1,
                            time: 1500
                        });
                        // editor.disable()

                        // $('#blog_title').val("")
                        // editor.clear()
                        /* // 延迟3秒
                         setTimeout(function () {
                           // 跳转后台首页
                           window.location.href = "/index";
                         }, 2000);*/

                        return false;
                    } else {
                        alert(res.msg())
                        // 错误信息
                        // layer.msg(res.msg, {icon: 2, anim: 6});

                    }
                },
                error: function () {
                    layer.msg("AJAX请求异常");
                }
            });


        });
    });
</script>
<!--
<script>
   // const E = window.wangEditor
    const {createEditor,createToolbar}= window.wangEditor
    // 切换语言
    const LANG = location.href.indexOf('lang=en') > 0 ? 'en' : 'zh-CN'
   createEditor.i18nChangeLanguage(LANG)

    const editorConfig = {
        placeholder: 'Type here...',
        scroll: false, // 禁止编辑器滚动
        MENU_CONF: {
            uploadImage: {
                fieldName: 'your-fileName',
                base64LimitSize: 10 * 1024 * 1024 // 10M 以下插入 base64
            }
        },
        onChange(editor) {
            console.log(editor.getHtml())
        }
    }

    // 先创建 editor
    const editor = createEditor({
        selector: '#editor-text-area',
        content: [],
        // html: '',
        config: editorConfig
    })

    // 创建 toolbar
    const toolbar = createEditor.createToolbar({
        editor,
        selector: '#editor-toolbar',
        config: {
            excludeKeys: 'fullScreen',
        }
    })

    // 点击空白处 focus 编辑器
    document.getElementById('editor-text-area').addEventListener('click', e => {
        if (e.target.id === 'editor-text-area') {
            editor.blur()
            editor.focus(true) // focus 到末尾
        }
    })
    $('#hq').on('click', function () {
        alert(editor.getHtml())
    });
</script>
-->
</html>